/*! Chatsi Analytics SDK v1.0.0 | (c) Chatsi | MIT License */
((t,e)=>{const s="phc_zAiXuc01e3hVHns0fvQoK416hn3KRAQ0WGJy3sf31hg",o="https://us.i.posthog.com",a={selectors:['[class*="add-to-cart"]','[class*="addtocart"]','[class*="add-cart"]','[class*="add-to-bag"]','[class*="add-to-basket"]','[id*="add-to-cart"]','[id*="addtocart"]','button[class*="cart"]',".product-form__submit",".shopify-buy__btn",'[name="add"]',".btn--add-to-cart",".single_add_to_cart_button",".add_to_cart_button",".product_type_simple",".action.primary.tocart","#product-addtocart-button",".box-tocart button",'[data-button-type="add-cart"]',".add-to-cart-button",".add-to-cart-global",".add-to-cart-button",".add-to-bag",".add-to-basket",".add-product",".btn-add-cart",".addtobag"],textPatterns:[/add to (cart|bag|basket)/i,/add item/i,/buy now/i,/shop now/i,/purchase/i]},i={selectors:['[class*="remove"]','[class*="delete"]','[class*="cart-item-remove"]','[class*="remove-product"]','[class*="delete-item"]',".remove-product",".delete-item",".cart-delete",".remove-from-cart",'[data-action="remove"]'],textPatterns:[/remove/i,/delete/i]},r={selectors:['[class*="product-link"]','[class*="product-tile"]','[class*="product-card"]','[class*="product-item"]','[class*="product-image"]',".product-name a",".product-title a","[data-product-id]","[data-pid]",".product-photo",".product-item-link"]},c={selectors:['[class*="checkout"]','[class*="proceed-to-checkout"]','[class*="go-to-checkout"]',"#checkout-btn",".checkout-button",".btn-checkout",".cart-checkout",'[data-action="checkout"]'],textPatterns:[/checkout/i,/proceed to checkout/i,/continue to checkout/i,/go to checkout/i,/complete purchase/i]},n={selectors:['[class*="search"]','input[type="search"]','form[class*="search"]',"#search-form",".search-form",'[role="search"]']},d={selectors:['[class*="wishlist"]','[class*="favorite"]','[class*="add-to-wishlist"]','[class*="save-for-later"]',".save-for-later",".add-to-favorites",'[data-action="wishlist"]'],textPatterns:[/add to wishlist/i,/save for later/i,/add to favorites/i,/favorite/i]},l={selectors:['[class*="newsletter"]','[class*="subscribe"]','[class*="email-signup"]','form[class*="email"]',".newsletter-form",".subscription-form"],textPatterns:[/subscribe/i,/sign up/i,/join/i,/newsletter/i]},u={selectors:['[class*="quick-view"]','[class*="quickview"]','[data-action="quick-view"]',".quickview-button"],textPatterns:[/quick view/i,/quick shop/i]},h={selectors:['[class*="compare"]','[data-action="compare"]',".add-to-compare"],textPatterns:[/compare/i,/add to compare/i]};class g{constructor(t={}){this.config={merchantId:t.merchantId||this._extractFromScript("data-merchant-id"),debug:t.debug||"true"===this._extractFromScript("data-debug"),distinctId:this._getOrCreateDistinctId(),sessionId:this._getOrCreateSessionId()},this.initialized=!1,this.eventQueue=[],this.posthogLoaded=!1,this.config.debug&&(console.log("[Chatsi SDK] v1.0.0 initialized"),console.log("[Chatsi SDK] Merchant ID:",this.config.merchantId))}_extractFromScript(t){const s=e.querySelectorAll('script[src*="chatsi-analytics"], script[src*="chatsi-sdk"]');for(const e of s){const s=e.getAttribute(t);if(s)return s}return null}async init(){if(!this.initialized)if(this.config.merchantId)if(s){this.config.debug&&(console.log("[Chatsi SDK] ðŸš€ Initializing with PostHog key:",s.substring(0,10)+"..."),console.log("[Chatsi SDK] PostHog host:",o));try{await this._loadPostHog(),this.config.debug&&console.log("[Chatsi SDK] After _loadPostHog, window.posthog exists:",!!t.posthog),t.posthog?(this.config.debug&&console.log("[Chatsi SDK] Calling posthog.init()..."),t.posthog.init(s,{api_host:o,autocapture:!1,capture_pageview:!1,persistence:"localStorage",loaded:t=>{this.posthogLoaded=!0,"function"==typeof t.opt_in_capturing&&(t.opt_in_capturing(),this.config.debug&&console.log("[Chatsi SDK] âœ… Opted in to capturing")),this._processQueue(),this.config.debug&&(console.log("[Chatsi SDK] âœ… PostHog loaded successfully"),console.log("[Chatsi SDK] PostHog instance:",t))}})):console.error("[Chatsi SDK] âŒ PostHog library loaded but window.posthog is undefined"),this.initialized=!0,this._startAutoCapture(),this.config.debug&&console.log("[Chatsi SDK] âœ… Auto-capture enabled")}catch(t){console.error("[Chatsi SDK] âŒ Init failed:",t)}}else console.error("[Chatsi SDK] PostHog API key not configured.");else console.error("[Chatsi SDK] merchantId is required. Add data-merchant-id to script tag.")}_loadPostHog(){return new Promise((s,o)=>{if(t.posthog)return this.config.debug&&console.log("[Chatsi SDK] PostHog already loaded"),void s();this.config.debug&&console.log("[Chatsi SDK] Loading PostHog library...");const a=e.createElement("script");a.src="https://unpkg.com/posthog-js@1.96.1/dist/array.full.js",a.async=!0,a.onload=()=>{this.config.debug&&(console.log("[Chatsi SDK] PostHog library loaded from CDN"),console.log("[Chatsi SDK] window.posthog available:",!!t.posthog)),setTimeout(s,100)},a.onerror=t=>{console.error("[Chatsi SDK] Failed to load PostHog library from unpkg");const a=e.createElement("script");a.src="https://cdn.jsdelivr.net/npm/posthog-js@1.96.1/dist/array.full.js",a.async=!0,a.onload=()=>{this.config.debug&&console.log("[Chatsi SDK] PostHog loaded from fallback CDN (jsdelivr)"),setTimeout(s,100)},a.onerror=()=>{console.error("[Chatsi SDK] All CDN attempts failed"),o(new Error("Failed to load PostHog from any CDN"))},e.head.appendChild(a)},e.head.appendChild(a)})}_getOrCreateDistinctId(){try{const t=localStorage.getItem("chatsi_distinct_id");if(t)return t;const e="user_"+this._generateId();return localStorage.setItem("chatsi_distinct_id",e),e}catch{return"user_"+this._generateId()}}_getOrCreateSessionId(){try{const t=sessionStorage.getItem("chatsi_session_id");if(t)return t;const e="session_"+this._generateId();return sessionStorage.setItem("chatsi_session_id",e),e}catch{return"session_"+this._generateId()}}_generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}_processQueue(){for(;this.eventQueue.length>0;){const t=this.eventQueue.shift();this._sendEvent(t.name,t.properties)}}_sendEvent(s,o={}){if(!this.posthogLoaded||!t.posthog)return this.config.debug&&console.log("[Chatsi SDK] Queueing event (PostHog not ready):",s),void this.eventQueue.push({name:s,properties:o});const a={...o,merchantId:this.config.merchantId,sessionId:this.config.sessionId,sdk_version:"1.0.0",timestamp:Date.now(),page_url:t.location.href,page_title:e.title,referrer:e.referrer,user_agent:navigator.userAgent};try{this.config.debug&&(console.log("[Chatsi SDK] ðŸ“Š Capturing event:",s),console.log("[Chatsi SDK] Properties:",a),console.log("[Chatsi SDK] PostHog instance:",t.posthog)),t.posthog.capture(s,a),this.config.debug&&console.log("[Chatsi SDK] âœ… Event captured successfully")}catch(t){console.error("[Chatsi SDK] âŒ Capture failed:",t)}}_startAutoCapture(){this._capturePageView(),this._setupClickTracking(),this._setupFormTracking(),this._setupMutationObserver(),this._detectPageType(),this._setupUnloadTracking()}_capturePageView(){this._sendEvent("page_view",{viewport_width:t.innerWidth,viewport_height:t.innerHeight,screen_width:t.screen.width,screen_height:t.screen.height,device_type:this._getDeviceType()})}_getDeviceType(){const t=navigator.userAgent;return/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(t)?"tablet":/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(t)?"mobile":"desktop"}_setupClickTracking(){e.addEventListener("click",t=>{const e=t.target;e&&(this._matchesPattern(e,a)?this._handleAddToCart(e):this._matchesPattern(e,i)?this._handleRemoveFromCart(e):this._matchesPattern(e,c)?this._handleCheckout(e):this._matchesPattern(e,r)?this._handleProductClick(e):this._matchesPattern(e,d)?this._handleWishlistAdd(e):this._matchesPattern(e,u)?this._handleQuickView(e):this._matchesPattern(e,h)&&this._handleCompare(e))},!0)}_setupFormTracking(){e.addEventListener("submit",t=>{const e=t.target;e&&"FORM"===e.tagName&&(this._matchesPattern(e,n)?this._handleSearch(e):this._matchesPattern(e,l)&&this._handleNewsletter(e))},!0)}_matchesPattern(t,e){if(!t)return!1;if(e.selectors)for(const s of e.selectors)try{if(t.matches&&t.matches(s))return!0;if(t.closest&&t.closest(s))return!0}catch(t){}if(e.textPatterns){const s=t.textContent||t.value||"";for(const t of e.textPatterns)if(t.test(s))return!0}return!1}_extractProductData(t){const e={},s=t.closest('[data-product-id], [data-pid], [class*="product"]')||t;e.id=s.getAttribute("data-product-id")||s.getAttribute("data-pid")||s.getAttribute("data-itemid")||s.getAttribute("data-id")||this._extractFromUrl(s.href,["pid","id","product"]);const o=s.querySelector('[class*="product-name"], [class*="product-title"], .name, .title')||s.querySelector("h1, h2, h3, h4");e.name=s.getAttribute("data-product-name")||s.getAttribute("data-name")||(o?o.textContent.trim():"");const a=s.querySelector('[class*="price"]:not([class*="original"]), [data-price]'),i=s.getAttribute("data-price")||s.getAttribute("data-product-price")||(a?a.textContent:"");e.price=this._parsePrice(i),e.category=s.getAttribute("data-category")||s.getAttribute("data-product-category")||this._extractCategoryFromBreadcrumb();const r=s.querySelector("img");return e.image_url=r?r.src:"",e.sku=s.getAttribute("data-sku")||s.getAttribute("data-product-sku"),e}_parsePrice(t){if(!t)return null;const e=t.match(/[\d,]+\.?\d*/);return e?parseFloat(e[0].replace(/,/g,"")):null}_extractFromUrl(e,s){if(!e)return null;try{const o=new URL(e,t.location.origin);for(const t of s){const e=o.searchParams.get(t);if(e)return e}}catch(t){}return null}_extractCategoryFromBreadcrumb(){const t=e.querySelector('[class*="breadcrumb"]');if(!t)return null;const s=t.querySelectorAll("a");return s.length>1?s[s.length-2].textContent.trim():null}_handleAddToCart(t){const e=this._extractProductData(t);this._sendEvent("add_to_cart",{product_id:e.id,product_name:e.name,product_price:e.price,product_category:e.category,product_image:e.image_url,product_sku:e.sku,quantity:1,currency:this._detectCurrency(),button_text:t.textContent?.trim(),button_class:t.className})}_handleRemoveFromCart(t){const e=this._extractProductData(t);this._sendEvent("remove_from_cart",{product_id:e.id,product_name:e.name})}_handleCheckout(t){const e=this._extractCartData();this._sendEvent("checkout_started",{cart_value:e.total,cart_items:e.itemCount,currency:this._detectCurrency()})}_handleProductClick(t){const e=this._extractProductData(t);this._sendEvent("product_clicked",{product_id:e.id,product_name:e.name,product_price:e.price,product_category:e.category,product_url:t.href})}_handleWishlistAdd(t){const e=this._extractProductData(t);this._sendEvent("wishlist_add",{product_id:e.id,product_name:e.name,product_price:e.price})}_handleQuickView(t){const e=this._extractProductData(t);this._sendEvent("quick_view",{product_id:e.id,product_name:e.name})}_handleCompare(t){const e=this._extractProductData(t);this._sendEvent("product_compare",{product_id:e.id,product_name:e.name})}_handleSearch(t){const e=t.querySelector('input[type="search"], input[name*="search"], input[name="q"]'),s=e?e.value:"";this._sendEvent("search",{search_query:s,search_type:"submit"})}_handleNewsletter(t){this._sendEvent("newsletter_signup",{form_location:this._getElementLocation(t)})}_extractCartData(){const t={total:null,itemCount:null},s=e.querySelector('[class*="cart-total"], [class*="grand-total"], .total-price, .cart-total-price');s&&(t.total=this._parsePrice(s.textContent));const o=e.querySelector('[class*="cart-count"], [class*="item-count"], .cart-quantity, .minicart-quantity');if(o){const e=o.textContent.match(/\d+/);t.itemCount=e?parseInt(e[0]):null}return t}_detectCurrency(){const t=e.querySelector('[class*="currency"], [data-currency]');if(t){const e=(t.textContent||t.getAttribute("data-currency")).match(/[A-Z]{3}/);if(e)return e[0]}const s=e.body.textContent;return s.includes("$")?"USD":s.includes("â‚¬")?"EUR":s.includes("Â£")?"GBP":s.includes("Â¥")?"JPY":s.includes("â‚¹")?"INR":"USD"}_detectPageType(){const s=t.location.pathname.toLowerCase(),o=e.body;if(s.includes("/product")||s.includes("/p/")||o.classList.contains("product-detail")||o.classList.contains("product-page")){const t=this._extractProductData(e.body);t.id&&this._sendEvent("product_view",{product_id:t.id,product_name:t.name,product_price:t.price,product_category:t.category})}else if(s.includes("/category")||s.includes("/search")||s.includes("/c/")||o.classList.contains("category-page")){const t=e.querySelectorAll('[data-product-id], [data-pid], [class*="product-tile"]');this._sendEvent("category_view",{products_count:t.length})}else if(s.includes("/cart")||s.includes("/basket")||o.classList.contains("cart-page")){const t=this._extractCartData();this._sendEvent("cart_view",{cart_value:t.total,cart_items:t.itemCount})}else(s.includes("/checkout")||o.classList.contains("checkout-page"))&&this._sendEvent("checkout_view",{step:this._detectCheckoutStep()})}_detectCheckoutStep(){const e=t.location.pathname;return e.includes("shipping")?"shipping":e.includes("billing")||e.includes("payment")?"payment":e.includes("review")?"review":e.includes("confirmation")?"confirmation":"start"}_getElementLocation(t){if(t.id)return`#${t.id}`;const e=Array.from(t.classList);return e.length>0?`.${e[0]}`:t.tagName.toLowerCase()}_setupMutationObserver(){new MutationObserver(t=>{t.length>5&&this._detectPageType()}).observe(e.body,{childList:!0,subtree:!0})}_setupUnloadTracking(){t.addEventListener("beforeunload",()=>{const t=Date.now()-performance.timing.navigationStart;this._sendEvent("page_exit",{time_on_page:t})})}capture(t,e={}){this._sendEvent(t,e)}identify(e,s={}){t.posthog&&"function"==typeof t.posthog.identify&&(t.posthog.identify(e,s),this.config.debug&&console.log("[Chatsi SDK] ðŸ‘¤ User identified:",e))}reset(){t.posthog&&"function"==typeof t.posthog.reset&&(t.posthog.reset(),this.config.distinctId=this._getOrCreateDistinctId(),this.config.sessionId=this._getOrCreateSessionId(),this.config.debug&&console.log("[Chatsi SDK] ðŸ”„ User reset"))}}const p=new g;"loading"===e.readyState?e.addEventListener("DOMContentLoaded",()=>p.init()):p.init(),t.ChatsiAnalytics=g,t.chatsiSDK=p})(window,document);